<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Admin Tools</title>
    <script>
        function submitForm() {
            document.getElementById("sortForm").submit();
        }

        function confirmDeletion() {
            return confirm("Are you sure you want to delete this project?");
        }
    </script>
</head>
<script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.3/dist/Chart.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@0.7.0"></script>

<link href="https://fonts.googleapis.com/css2?family=Open+Sans&display=swap" rel="stylesheet">

   <style>
   .average-description-length {
    font-size: 20px; /* Makes text larger */
    margin-bottom: 10px; /* Adds a gap below the text */
    display: block; /* Ensures margin-bottom is applied */
}

.overlay {
    display: none;
    position: fixed;
    width: 100%;
    height: 100%;
    top: 0;
    left: 0;
    background: rgba(0, 0, 0, 0.7);
    z-index: 1000;
}

.overlay-content {
    position: relative;
    top: 25%;
    width: 60%;
    margin: auto;
    padding: 20px;
    background: white;
    border-radius: 10px;
}

.closebtn {
    position: absolute;
    top: 10px;
    right: 25px;
    font-size: 35px;
    cursor: pointer;
}

#projectsList {
    list-style-type: none;
}


   .stats-container {
   margin-top: 20px;
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
}

   .stats-container2 {
   margin-top: 15px;
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
}

.stat-box {
    background-color: #f5f5f5; /* Example background color */
    margin: 5px;
    padding: 5px;
    border-radius: 30px;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
    flex-basis: calc(33.333% - 20px); /* For desktop */
}

.stat-box2 {
    background-color: #f5f5f5; /* Example background color */
    margin: 5px;
    padding: 20px;
    border-radius: 10px;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
}


@media (min-width: 1080px) and (max-width: 1445px) {
    .stat-box {
        flex-basis: calc(50% - 20px); /* For tablet */
    }
}

@media (max-width: 1080px) {
    .stat-box {
        flex-basis: 100%; /* For mobile */
    }
}

   
body {
                   font-family: MaisonNeue,Segoe UI,Helvetica Neue,-apple-system,system-ui,BlinkMacSystemFont,Roboto,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol;

    background-color: #f5f1e4;
    color: black;
    margin: 0;
    padding: 0;
    text-align: center; /* Center text globally */
}

.c-button {
        border-radius: 10px;
        padding: 12px;
        background-color: white;
        font-weight: bold;
        color: black;
        border: none;
        cursor: pointer;
        margin: 10px;
        transition: background-color 0.3s;
    }

    .c-button.active {
        background-color: #4CAF50; /* Green background for active button */
        color: white;
    }
	
#filter-form-mobile {
    display: none; /* Hidden by default */
}
        img {
            border-radius: 30px;
            transition: width 0.3s ease;
        }

        .logo {
            max-width: 1000px; /* Increase the max-width to make it bigger */
            margin-bottom: 30px;
        }

        img:hover {
            transform: scale(1.00);
        }

        .button {
            border-radius: 30px;
            padding: 15px;
            background-color: white;
            font-weight: bold;
            color: black;
            border: none;
            cursor: pointer;
        }

        .input-field {
            border-radius: 5px;
            padding: 5px;
            border: 1px solid #ccc;
        }

        .form-container {
            margin: auto;
            width: 50%;
            padding: 10px;
        }

        .project img {
            max-width: 300px; /* Adjust the width as needed */
            max-height: 200px; /* Adjust the height as needed */
            height: auto; /* Maintain aspect ratio */
            width: auto; /* Maintain aspect ratio */
            border-radius: 30px; /* Optional: if you want rounded corners */
        }
		
		
		.projects-header {
    text-align: center; /* Center the content */
    margin-bottom: 20px; /* Add some space below the header */
}

.projects-header h1 {
    margin: 0; /* Remove default margin */
    padding: 10px 0; /* Add some vertical padding */
}

.projects-header p {
    margin: 0; /* Remove default margin */
    color: #003056; /* Specific color for the undertitle */
    font-style: italic; /* Optional: make it italic */
}

		
/* Style for filter-button on desktop */
.filter-bar .filter-button {
    background-color: #02569d; /* Button background color */
    color: white; /* Text color */
    border: none; /* No border */
    padding: 14px 20px; /* Padding inside the button */
    font-size: 16px; /* Font size */
    font-weight: bold; /* Font weight */
    border-radius: 30px; /* Rounded corners */
    cursor: pointer; /* Cursor on hover */
    transition: background-color 0.3s ease; /* Smooth transition for hover effect */
}

.control-bar {
    background-color: #ddd; /* Light grey background */
    padding: 10px;
    display: flex;
    justify-content: center;
    align-items: center;
    box-shadow: 0px 2px 5px rgba(0,0,0,0.2);
}


/* Hover effect for filter-button */
.filter-bar .filter-button:hover {
    background-color: #002244; /* Darker shade for hover effect */
}
		      .register-button {
        background-color: #003056; /* Example color */
        color: white;
        border: none;
        border-radius: 10px;
		font-weight: bold !important;
        padding: 5px 10px;
        text-align: center;
        text-decoration: none;
        display: inline-block;
        font-size: 14px;
        margin: 10px 0;
        cursor: pointer;
        box-sizing: border-box; /* Include padding in width */
    }
		.register-button:hover {

    transform: scale(1.00); /* Scale up on hover */
}

		      .register-button2 {
        background-color: #003056; /* Example color */
        color: white;
        border: none;
        border-radius: 30px;
		font-weight: bold !important;
        padding: 5px 10px;
        text-align: center;
        text-decoration: none;
        display: inline-block;
        font-size: 14px;
        cursor: pointer;
        box-sizing: border-box; /* Include padding in width */
    }

h3 {
    display: block;
    font-size: 1.17em;
    margin-block-start: 0.3em;  /* Adjusted margin at the start */
    margin-block-end: 0.3em;    /* Adjusted margin at the end */
    margin-inline-start: 0px;
    margin-inline-end: 0px;
    font-weight: normal;
}


	
 .top-bar {
    background-color: #003056; /* Background color of the top bar */
    height: 80px; /* Height of the top bar */
    width: 100%; /* Full width of the screen */
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 20px 20px; /* Add padding to the left and right */
    box-sizing: border-box; /* Include padding in width calculation */
    align-items: center; /* This ensures vertical alignment */
}
.top-bar a .logo {
    max-width: auto; /* Adjust this value as needed */
    max-height: 80px; /* Ensure the logo fits within the bar's height */
margin: auto;
}

/* Styles for buttons inside links in the top bar */
.top-bar a button {
    transition: width 0.3s ease; /* Transition for the transform property */
    border-radius: 30px; /* If you want to keep the border-radius */
    /* Add any other button-specific styles here */
}

/* Hover effect for buttons inside links in the top bar */
.top-bar a button:hover {
    transform: scale(1.00); /* Scale up slightly on hover */
}


/* Hover effect for links in the top bar */
.top-bar a:not(:has(button)):hover::after {
    transform: scaleX(1); /* Show the underscore on hover */
    transform-origin: left;
}

.top-bar a {
    color: white;
    text-decoration: none;
    margin-right: 20px; /* Add spacing between links */
    font-size: 18px; /* Increase text size */
    font-weight: bold; /* Make text bold */
    position: relative;
    transition: color 0.3s ease, text-shadow 0.3s ease; /* Transition for color and text shadow */
}


/* Exclude the logo link from having the underline effect */
.top-bar a[href="/"]:hover::after {
    content: none;
}
/* Underline effect for links that do not contain the logo */
.top-bar a:not(:has(> .logo))::after {
    content: "";
    position: absolute;
    left: 0;
    bottom: -3px;
    width: 100%;
    height: 2px;
    background-color: white;
    transform: scaleX(0);
    transform-origin: right;
    transition: transform 0.3s;
}
/* Centering Pagination Wrapper */
nav[aria-label="Page navigation"] {
    display: flex; /* Use flexbox for alignment */
    justify-content: center; /* Center horizontally */
    margin: 20px 0; /* Add vertical margin for spacing */
}

/* Pagination Container */
.pagination {
    background-color: #003056; /* Background color */
    border-radius: 30px; /* Border radius */
    padding: 10px; /* Inner spacing */
    display: inline-flex; /* Align pagination items inline and allow flex properties */
}

/* Pagination Links */
.pagination .page-link {
    color: white;
    background-color: transparent;
    border: none;
    margin: 0 5px;
    text-decoration: none; /* Remove underline */
    font-weight: bold; /* Make it bold */
}

/* Pagination Items */
.pagination .page-item {
    display: inline-block; /* Display items inline */
}

/* Pagination Active Page */
.pagination .page-item.active .page-link {
    background-color: #02569d; /* Background for active page */
    border-color: #02569d; /* Border for active page */
}

/* Pagination Item Hover */
.pagination .page-item:hover .page-link {
    background-color: #2874A6; /* Slightly lighter blue on hover */
    border-color: #2874A6; /* Border color on hover */
}

.control-bar .button {
    margin: 5px; /* Adds margin around each button */
    transition: background-color 0.3s; /* Smooth transition for color change */
}

.control-bar .button.active {
    background-color: #003056; /* Changes the color when active */
    color: white; /* Adjust text color for better visibility */
}


/* Additional styles for .logo to ensure it fits well in the top bar */
.top-bar a .logo {
    max-width: auto; /* Adjust this value as needed */
    max-height: 80px; /* Ensure the logo fits within the bar's height */
    margin: auto;
}
.top-bar a:hover {
    color: #a8c0ff; /* Change color on hover */
    text-shadow: 0px 0px 8px rgba(255, 255, 255, 0.7); /* Add text shadow on hover */
}

.top-bar a::after {
    content: "";
    position: absolute;
    left: 0;
    bottom: -3px;
    width: 100%;
    height: 2px;
    background-color: white;
    transform: scaleX(0);
    transform-origin: right;
    transition: transform 0.3s;
}

/* Hover effect for buttons inside links in the top bar */
.top-bar a button:hover {
    transform: scale(1.00); /* Scale up slightly on hover */
}

.voting-bar {
    width: 90%;
    height: 20px;
    background-color: #ddd;
    border-radius: 30px !important;
    margin-top: 0px;
    display: flex;
}

.upvotes {
    height: 100%;
    background-color: #4caf50;
    border-radius: 30px !important;
    transition: width 0.3s ease;
}

.downvotes {
    height: 100%;
    background-color: #9A031E;
    border-radius: 30px !important;
    transition: width 0.3s ease;
}

.upvotes, .downvotes {
    /* Existing styles */
    position: relative; /* Ensure the position is relative for child positioning */
}

.upvotes span, .downvotes span {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    color: white; /* Choose a contrasting color */
    font-size: 12px; /* Adjust the font size */
    white-space: nowrap;
    pointer-events: none; /* Prevents blocking click events */
}


.export-section {
    background-color: #f8f9fa;
    border: 1px solid #ddd;
    padding: 15px;
    border-radius: 5px;
    margin-bottom: 20px;
}

.export-section h2 {
    color: #333;
    margin-bottom: 15px;
}

.export-section .filter-options > div {
    margin-bottom: 10px;
}

/* Underline effect for links that do not contain buttons */
.top-bar a:not(:has(> button))::after {
    content: "";
    position: absolute;
    left: 0;
    bottom: -3px;
    width: 100%;
    height: 2px;
    background-color: white;
    transform: scaleX(0);
    transform-origin: right;
    transition: transform 0.3s;
}

/* Hover effect to show underline for links that do not contain buttons */
.top-bar a:not(:has(> button)):hover::after {
    transform: scaleX(1);
}
.logged-in-info {
    text-align: center; /* Centers the text inside the div */
    padding: 2px 0; /* Adds some padding above and below the text */
    background-color: #f5f1e4; /* Optional: background color, if you want to highlight the div */
    /* Andere styling as needed, such as font size, color, etc. */
}

	
.filter-bar {
    background-color: #111111; /* Existing background color */
    height: 80px; /* Existing height */
    width: 100%; /* Full width */
    display: flex;
    justify-content: center; /* Center content horizontally */
    align-items: center; /* Center content vertically */
    padding: 0 20px; /* Existing padding */
    box-sizing: border-box;
    flex-wrap: nowrap; /* Existing no-wrap */
}

#filter-form {
    display: flex;
    align-items: center;
    justify-content: center; /* Center form contents */
    width: 100%; /* Use the full width of the parent */
    max-width: 800px; /* Set a max-width if needed */
}

.filter-item {
    margin: 0 10px; /* Add some horizontal spacing between items */
}

/* You might need to adjust the width of inputs/selects inside filter-items */
.filter-item input, 
.filter-item select {
    width: auto; /* Adjust width as needed */
}

.filter-bar .filter-item label {
    font-size: 18px; /* Adjust the font size for labels */
}

.filter-item {
    display: flex;
    align-items: center;
    margin-right: 20px; /* Spacing between filter items */
}

.filter-item label {
    color: white;
    margin-right: 10px; /* Spacing between label and input/select */
}

/* Apply styles to fields within .filter-bar */
.filter-bar input,
.filter-bar select {
    border-radius: 30px;
    padding: 15px;
    background-color: white;
    font-weight: bold;
    color: black;
    border: none;
    cursor: pointer;
}



    
    .index-image {
        width: 100%;
        object-fit: cover; /* Crop the image when necessary */
        max-height: 500px; /* Set a maximum height if needed */
       border-radius: 0; /* Remove border-radius */
    transition: none !important; /* Remove hover effect */
	transform: none !important;
}

    .cover-text-container {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background-color: rgba(0, 0, 0, 0.8); /* Black background with 70% opacity */
        padding: 20px;
        border-radius: 30px;
        text-align: center;
    }

    .cover-text-container h1 {
        font-size: 40px;
        color: white;
        margin: 0;
        padding-bottom: 10px;
    }

    .cover-text-container p {
        font-size: 30px;
        color: white;
        margin: 0;
    }
	
	    .info-box-container {
            display: flex;
            justify-content: space-evenly;
            padding: 20px;
        }

        .info-box {
            background-color: #1b1b1b;
            border-radius: 30px;
            padding: 20px;
            text-align: center;
            transition: width 0.3s ease;
            width: 30%; /* Set a fixed width for each box */
        }

        .info-box:hover {
            transform: scale(1.00);
        }
        .info-box-icon {
            max-width: 70px; /* Icon size */
            border-radius: 50%; /* Make it circular */
        }

        .info-box-title {
            color: white;
            font-size: 30px;
            margin: 10px 0;
        }

        .info-box-undertitle {
            color: white;
            font-size: 16px;
        }


.c-button {
    /* Your existing button styles */
    margin: 5px;
    transition: background-color 0.3s;
}

.c-button.active {
    background-color: green; /* Green color for active button */
    color: white;
}

        /* Specific colors for each box */
        .box-red {
            background-color: #06467c ;
        }

        .box-blue {
            background-color: #02569d ;
        }

        .box-green {
            background-color: #2874A6 ;
        }
		
	.info-text-field {
            background-color: #F4F4F8; /* Light grey background */
            width: 100%; /* Full width */
            height: 400px; /* Specified height */
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            padding: 20px;
            box-sizing: border-box; /* Include padding in width calculation */
        }
        .info-text-container {
            width: 50%; /* Width of the text container */
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }

        .info-text-title {
            font-size: 30px;
            color: black;
            margin-bottom: 10px;
        }

        .info-text-undertitle {
            font-size: 20px;
            color: black;
            margin-top: 10px;
			}
			
			   .project-list#user-list-container {
        width: 100%; /* Full width */
        display: flex; /* Use flexbox for layout */
        flex-wrap: wrap; /* Allow items to wrap */
        justify-content: space-evenly; /* Even spacing between items */
        align-items: flex-start; /* Align items to start vertically */
    }
	
			    /* Base styles for user thumbnails */
    .user-thumbnail {
        background-color: #f9f8f5; /* Similar background color */
        border-radius: 10px; /* Rounded corners */
        padding: 10px; /* Padding inside each thumbnail */
        display: flex; /* Use flexbox for layout */
        flex-direction: column; /* Stack items vertically */
        align-items: center; /* Center items horizontally */
        box-sizing: border-box; /* Include padding and border in width/height */
        transition: width 0.3s ease; /* Smooth scaling on hover */
        position: relative; /* Position relative for any positioned children */
        overflow: hidden; /* Hide overflow */
        width: calc(33.333% - 20px); /* Three items per row */
        margin: 10px; /* Adjust margin as needed */
		    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);

    }


    /* Hover effect for user thumbnails */
    .user-thumbnail:hover {
        transform: scale(1.00); /* Slight scale on hover */
    }

    /* Style for the details inside user thumbnails */
    .user-thumbnail .project-details {
        text-align: center; /* Center the text */
        width: 100%; /* Take full width */
    }

    /* Responsive design for different screen sizes */
    @media (min-width: 1445px) {
        .user-thumbnail {
            width: calc(33.333% - 20px); /* Three items per row */
        }
    }

    @media (min-width: 1080px) and (max-width: 1445px) {
        .user-thumbnail {
            flex-basis: calc(50% - 20px); /* Two items per row */
        }
    }

    @media (max-width: 1088px) {
        .user-thumbnail {
            flex-basis: calc(100% - 20px); /* Full width on smaller screens */
        }
    }
/* Base styles for project thumbnails */
.project-thumbnail {
    background-color: #f9f8f5;
    border-radius: 30px;
    margin: 10px;
    padding: 10px;
    display: flex; /* Changed to flex to better control the layout */
    flex-direction: column; /* Stack items vertically */
    align-items: center; /* Center items horizontally */
    box-sizing: border-box;
    transition: width 0.3s ease;
    position: relative;
    overflow: visible; /* Ensure the content is not clipped */

    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
}


	.user-info {
    color: white; /* Set the text color to match other links */
    margin-right: 20px; /* Right margin for spacing */
    font-size: 18px; /* Font size similar to other links */
    font-weight: bold; /* Bold text */
    align-self: center; /* Align vertically within the flex container */
	
}

/* Hover effect for project thumbnails */
.project-thumbnail:hover {
    transform: scale(1.00);
}

/* Image style within project thumbnails */
.project-thumbnail img {
    width: 90%;
    margin-top: 20px;
    height: 400px; /* Fixed height for images */
    object-fit: cover;
    border-radius: 30px;
}

/* Text style inside project thumbnails */
.project-thumbnail h2, .project-thumbnail p {
    margin: 0;
    padding: 5px 0;
    width: 90%; /* Adjust the width to match the image */
    text-align: center; /* Center the text */
}

.project-thumbnail p {
    font-family: 'Open Sans', sans-serif; /* Change to your preferred font */
    position: relative;
    bottom: auto;
    overflow: visible;
    text-align: center;
    width: 100%;
    display: block;
    font-weight: normal; /* Ensure the font weight is normal */
}



/* Desktop screens (larger than 1200px) */
@media (min-width: 1445px) {
    .project-thumbnail {
        width: calc(33.333% - 20px); /* Three items per row */
        height: auto; /* Height adjusts based on content */
    }
}

/* Medium screens (between 1024px and 1199px) */
@media (min-width: 1080px) and (max-width: 1445px) {
    .project-thumbnail {
        width: calc(50% - 20px); /* Two items per row */
        height: auto; /* Height adjusts based on content */
    }
}

/* Mobile screens (less than 1024px) */
@media (max-width: 1088px) {
    .project-thumbnail {
        width: calc(100% - 20px); /* Full width */
        height: auto; /* Height adjusts based on content */
    }
    .project-thumbnail img {
        height: auto; /* Adjust image height for mobile */
    }
}
.comment-list {
    display: flex;
    flex-wrap: wrap;
    justify-content: center; /* Center items */
    align-items: flex-start;
    width: 100%;
    box-sizing: border-box;
    padding: 10px;
}
  ul {
        list-style-type: none; /* Removes bullet points */
        padding-left: 0; /* Removes default padding */
    }

.comment-thumbnail {
    flex-basis: calc(33.333% - 20px); /* Three items per row, adjust margin as needed */
    width: calc(33.333% - 20px); /* Explicitly set width */
    margin: 10px; /* Margin around each thumbnail */
    padding: 10px;
    display: flex;
    flex-direction: column;
    align-items: center;
    box-sizing: border-box;
  background-color: #f9f8f5; /* Similar to project-thumbnail */
    border-radius: 30px; /* Similar to project-thumbnail */
	    transition: width 0.3s ease; /* Smooth scaling on hover */

	}


   
@media (min-width: 1080px) and (max-width: 1445px) {
    .comment-thumbnail {
        flex-basis: calc(50% - 20px); /* Two items per row */
        width: calc(50% - 20px); /* Explicitly set width */
    }
}

@media (max-width: 1088px) {
    .comment-thumbnail {
        flex-basis: 100%; /* Full width on smaller screens */
        width: 100%; /* Explicitly set width */
    }
}

/* Hover effect for comment thumbnails */
.comment-thumbnail:hover {
    transform: scale(1.00); /* Slight scale on hover */
}

/* Style for the details inside comment thumbnails */
.comment-thumbnail .comment-details {
    text-align: center; /* Center the text */
    width: 100%; /* Take full width */
}



@media (min-width: 1080px) {
    .comment-thumbnail {
        width: calc(50% - 20px); /* Two items per row */
    }
}

@media (max-width: 1088px) {
    .comment-thumbnail {
        width: calc(100% - 20px); /* Full width on smaller screens */
    }
}

.pagination-container {
        width: 100%; /* Make the container take full width */
        display: flex; /* Use flexbox for layout */
        justify-content: center; /* Center pagination horizontally */
        margin-top: 20px; /* Add some space above the pagination */
    }
.project-list {
        display: flex; /* Use flexbox for layout */
        flex-wrap: wrap; /* Allow items to wrap to next line */
        justify-content: center; /* Center items horizontally */
        align-items: flex-start; /* Align items to the start of the container vertically */
    }
    /* Overlay styles */
    .overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.7);
        z-index: 999;
        align-items: center;
        justify-content: center;
    }

    .overlay-content {
        background-color: white;
        border-radius: 30px;
        padding: 20px;
        max-width: 80%;
    }

    .close-btn {
        position: absolute;
        top: 10px;
        right: 10px;
        cursor: pointer;
		display: none;
    }
	
	/* Modal Styles */
.modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    overflow: auto;
    background-color: rgba(0,0,0,0.4);
}

.modal-content {
    background-color: #fefefe;
    margin: 10% auto;
    padding: 20px;
    border: 1px solid #888;
    width: 80%;
}

.close {
    color: #aaa;
    float: right;
    font-size: 28px;
    font-weight: bold;
}

.close:hover,
.close:focus {
    color: black;
    text-decoration: none;
    cursor: pointer;
}


@media only screen and (max-width: 1445px) {
.top-bar a button {
    transition: width 0.3s ease; /* Transition for the transform property */
    border-radius: 30px; /* If you want to keep the border-radius */
	padding: 7px;
    /* Add any other button-specific styles here */
}


.c-button {
        border-radius: 10px;
        padding: 6px;
        background-color: white;
        font-weight: bold;
        color: black;
        border: none;
        cursor: pointer;
        margin: 10px;
        transition: background-color 0.3s;
    }

	

}

    a {
            color: #003056; /* Set the color of links */
            text-decoration: none; /* Optional: removes underline from links */
        }

        a:hover {
            text-decoration: underline; /* Optional: underline on hover */
        }


	
#hamburger-button {
    display: none; /* Hidden by default */
	}
	
#hamburger-button-filter {
    display: none; /* Hidden by default */
	}
@media only screen and (max-width: 1080px) {
    html, body {
        max-width: 100vw; /* Prevent horizontal overflow */
        overflow-x: hidden; /* Hide horizontal scrollbar */
    }

#nav-links .user-info {
        display: block; /* Make it a block element */
        width: 100%; /* Full width */
        text-align: center; /* Center text horizontally */
        margin: 10px 0; /* Optional: adjust top and bottom margin as needed */
    }
	
    body {
        font-size: 14px; /* Smaller font size */
    }
    .top-bar {
        flex-direction: column; /* Stack items vertically */
        height: auto; /* Adjust height automatically */
    }
    .form-container {
        width: 90%; /* Full width with some margin */
        padding: 20px; /* Smaller padding */
    }
    .publish-button {
        font-size: 18px; /* Slightly smaller font size */
        padding: 15px 0; /* Adjust padding */
    }
.filter-bar .filter-button {
        /* Add any desktop-specific styles here */
        padding: 10px 20px; /* Example: different padding */
        margin-left: 10px; /* Add space between button and preceding elements */
    }
	
	/* Hamburger Menu Button */
#hamburger-button {
    display: none; /* Hidden by default */
    font-size: 30px; /* Icon size */
    color: white; /* Icon color */
    background: none; /* No background */
    border: none; /* No border */
    cursor: pointer; /* Pointer cursor */
}
#hamburger-button-filter {
    display: none; /* Hidden by default */
    font-size: 20px; /* Icon size */
    color: white; /* Icon color */
    background-color: #111111; /* No background */
    border: none; /* No border */
    cursor: pointer; /* Pointer cursor */
}
/* Navigation Overlay */
.nav-overlay {
    display: none; /* Hidden by default */
    position: fixed; /* Fixed position */
    width: 100%; /* Full width */
    height: 100%; /* Full height */
    top: 0;
    left: 0;
    background-color: rgba(0, 0, 0, 0.9); /* Semi-transparent black */
    overflow-x: hidden; /* Hide horizontal overflow */
    transition: 0.5s; /* Smooth transition for opening/closing */
    z-index: 1000; /* High z-index to ensure it's on top */
}


#filter-overlay {
    display: none; /* Hidden by default */
    position: fixed;
    width: 100%;
    height: 100%;
    top: 0;
    left: 0;
    background-color: rgba(0, 0, 0, 0.9);
    overflow-x: hidden; /* Hide horizontal overflow */
    transition: 0.5s;
    z-index: 1000;
    align-items: center; /* Center content vertically */
    justify-content: center; /* Center content horizontally */
}
.nav-overlay-active .main-content {
    pointer-events: none;
}



/* Mobile Devices */
@media only screen and (max-width: 1080px) {
    html, body {
        max-width: 100vw; /* Prevent horizontal overflow */
        overflow-x: hidden; /* Hide horizontal scrollbar */
    }

    #hamburger-button {
        display: block; /* Show the button on mobile */
    }

 #hamburger-button-filter {
        display: block; /* Show the button on mobile */
		  width: 100%; /* Make it span the entire width of the screen */
            text-align: center; /* Center the icon/text inside the button */
            padding: 10px 0; /* Adjust padding as needed for better touch area */
      
    }
    .top-bar a .logo {
        margin-left: auto; /* Adjust logo position */
		margin-right: auto;
    }
	
	    /* Specific styles for filter form in overlay */
#filter-form-mobile {
    display: flex;
    flex-direction: column;
    align-items: stretch; /* Stretch items to fill the width */
    justify-content: center;
    padding: 20px;
    width: 90%;
    max-width: 400px;
    margin: auto;
    border-radius: 30px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
}



#filter-form-mobile .filter-button {
    padding: 15px 15px;
    background-color: #003056; /* Adjust the color as needed */
    color: white;
    border: none;
    border-radius: 30px;
    font-size: 16px;
    cursor: pointer;
    text-align: center;
    width: 100%;
    margin-top: 10px;
}

#filter-form-mobile .filter-button:hover {
    background-color: #004680; /* Darker shade for hover effect */
}


#filter-form-mobile #search {
    width: 100%;
    padding: 15px; /* Adjust padding if necessary */
    margin-bottom: 10px; /* Consistent margin with other fields */
    border-radius: 30px; /* Consistent border-radius with other fields */
    border: 1px solid #ccc; /* Consistent border */
    font-size: 16px; /* Consistent font size */
    box-sizing: border-box; /* Include padding and border in width */
}

#filter-form-mobile .filter-item {
    flex-direction: column; /* Stack elements vertically */
    align-items: center; /* Center items horizontally */
    width: 100%; /* Ensure each item takes full width */
    margin-bottom: 10px; /* Spacing between filter items */
}



.filter-input {
    width: 100%; /* Ensures full width */
    padding: 10px 15px; /* Consistent padding for all elements */
    border-radius: 5px; /* Consistent border-radius */
    border: 1px solid #ccc; /* Consistent border style */
    font-size: 16px; /* Consistent font size */
    box-sizing: border-box; /* Include padding and border in the element's total width and height */
}

/* Style for input and select elements in filter-form-mobile */
#filter-form-mobile .filter-item input,
#filter-form-mobile .filter-item select {
    width: 100%;
	outline: 5px solid #003056;
    padding: 15px;
    margin-bottom: 10px;
    border-radius: 30px;
    border: 1px solid #ccc;
    font-size: 16px;
    box-sizing: border-box;
}

/* Style for labels (titles) in filter-form-mobile */
#filter-overlay #filter-form-mobile .filter-item label {
    display: block;
    font-weight: bold;
    font-size: 30px; /* Increased font size for clarity */
    margin-bottom: 5px; /* Space between label and field */
    text-align: center !important; /* Force center align the text */
}

    /* Ensure filter bar is hidden on mobile */
    .filter-bar {
        display: none;
    }

    /* Additional styles for filter overlay to prevent overflow */
    #filter-overlay {
        overflow-y: auto; /* Enable vertical scrolling if needed */
    }

    #nav-links {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        height: 100%;
    }

    #nav-links a {
        padding: 20px; /* Larger clickable area */
        font-size: 24px; /* Larger font size */
    }
}

/* Mobile Devices */
@media only screen and (max-width: 1080px) {
    html, body {
        max-width: 100vw; /* Prevent horizontal overflow */
        overflow-x: hidden; /* Hide horizontal scrollbar */
    }

    .top-bar {
        flex-direction: row; /* Align items horizontally */
        justify-content: space-between; /* Space between items */
        align-items: center; /* Vertically center items */
        padding: 10px 15px; /* Consistent padding */
    }
	
	.filter-bar {
	display: none;
	}

    .top-bar a {
        display: flex; /* Flex container for the logo */
        align-items: center; /* Vertically center logo */
        margin: 0; /* Remove any default margin */
    }

    .top-bar a .logo {
        max-width: 270px; /* Adjust logo size */
        max-height: 350px; /* Adjust height automatically */
    }

    #hamburger-button {
        display: block; /* Show the button on mobile */
        margin: 0; /* Remove any margin */
        align-self: center; /* Explicitly center the button vertically */
    }
    #hamburger-button-filter {
        display: block; /* Show the button on mobile */
        margin: 0; /* Remove any margin */
        align-self: center; /* Explicitly center the button vertically */
    }
   
        #nav-links {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        height: 100%;

    #nav-links a {
        padding: 20px; /* Padding for each link */
        font-size: 24px; /* Font size for links */
    }
}
}


    </style>
<body>


<div class="top-bar">
    <a href="/">
        <img src="{{ url_for('static', filename='logo.png') }}" alt="Logo" class="logo">
    </a>  
    <button id="hamburger-button">&#9776;</button>

    <div id="nav-overlay" class="nav-overlay">
        <div id="nav-links">
            <a href="/karte">Karte</a>
            <a href="/list">Projektvorschläge</a>
            <a href="/neuerbeitrag">Vorschlag hinzufügen</a>
            <a href="/ueber">Über</a>
            <a href="/profil">Profil</a>
 {% if current_user.is_authenticated %}
            <span class="user-info" style="margin-top: 10px;">
                Admin: {{ current_user.name }}, ID: {{ current_user.id }}
            </span>
            <a href="{{ url_for('logout', next=request.path) }}"><button class="button">Abmelden</button></a>
            {% else %}
            <a href="{{ url_for('login', next=request.path) }}"><button class="button">Anmelden</button></a>
            {% endif %}
        </div>
    </div>
</div>
</div>

<!-- Update the buttons in the filter-bar div -->
<div class="filter-bar">
		<button id="toggleDeleteAllProjects" class="c-button" data-section-id="deleteAllProjectsSection">Statistik</button>
    <button id="toggleExportSection" class="c-button" data-section-id="exportSection">Datenexport</button>
    <button id="toggleProjectProposals" class="c-button" data-section-id="projectProposalsSection">Projektvorschläge</button>
    <button id="toggleNotes" class="c-button" data-section-id="notesSection">Notizen</button>
    <button id="toggleComments" class="c-button" data-section-id="commentsSection">Kommentare</button>
    <button id="toggleImportantProjects" class="c-button" data-section-id="importantProjectsSection">Markierte Projektvorschläge</button>
    <button id="toggleFeaturedProjects" class="c-button" data-section-id="featuredProjectsSection" style="display:none;">Open Ausgewählte Projektvorschläge</button>
    <button id="toggleUsers" class="c-button" data-section-id="usersSection">Benutzer</button>
</div>



<div id="deleteAllProjectsSection" class="delete-all-projects-section" style="display: none;">

<div class="stats-container">
<div class="stat-box" style="background-color: #fff3c3 !important">
<h2>Top 5 Meistgesehene Projekte</h2>
<ul>
  {% for project in top_viewed_projects %}
      {% if project.view_count > 0 %}
        <li><h3><a href="{{ url_for('project_details', project_id=project.id) }}"><strong>{{ project.name }}</strong></a> mit <strong>{{ project.view_count }}</strong> Aufrufen</h3></li>
      {% endif %}
  {% endfor %}
</ul>
</div>







<div class="stat-box" style="background-color: #ffd6a8 !important">
<h2>Top 5 Bewertete Projekte</h2>
<ul>
  {% for project in top_rated_projects %}
      <li><h3><a href="{{ url_for('project_details',project_id=project.id) }}"><strong>{{ project.name }}</strong></a> mit <strong>{{ project.upvote_count }}</strong> Stimmen</h3></li>
{% endfor %}

</ul>
</div>

<div class="stat-box" style="background-color: #e3ffff !important">
<h2>Top 5 Kommentierte Projekte</h2>
<ul>
  {% for project in top_commented_projects %}
      <li><h3><a href="{{ url_for('project_details', project_id=project.id) }}"><strong>{{ project.name }}</strong></a> mit <strong>{{ project.comments_count }}</strong> Kommentaren</h3></li>
  {% endfor %}
</ul>
</div>

<div class="stat-box" style="background-color: #b8d5ff !important">
<h2>Top 5 Häufigste Kategorien</h2>
<ul>
  {% for category, count in category_counts %}
      <li><h3><strong>{{ category }}</strong> mit <strong>{{ count }}</strong> Projekten</h3></li>
  {% endfor %}
</ul>
</div>

<div class="stat-box"  style="background-color: #b9ea9b !important">
<h2>Top 5 Aktivste Benutzerkonten</h2>
<ul>
  {% for user in active_users %}
     <li>
        <h3>
			<strong> {{ user.name }}</strong> mit 
          <strong>{{ user.project_count }}</strong> Projekten, 
          <strong>{{ user.map_object_count }}</strong> Kartenobjekten und 
          <strong>{{ user.comment_count }}</strong> Kommentaren
        </h3>
      </li>  {% endfor %}
</ul>
</div>
</div>

<div class="stats-container">
<div class="stat-box">
<div class="chart-container">
    <h2>Kategorieanteil</h2>
	    <div style="margin-bottom: 10px;"><span id="mostUsedCategoryText"></span></div>

    <div>
        <button class="mapobject-toggle active" data-filter="all">Alles</button>
        <button class="mapobject-toggle" data-filter="false">Nur Projektvorschläge</button>
        <button class="mapobject-toggle" data-filter="true">Nur Notizen</button>
        <button id="togglePercentage">Show Percentages</button> <!-- New Button -->
    </div>
    <canvas id="projectCategoryChart"></canvas>
</div>


</div>

<div class="stat-box">
<div class="chart-container">
<h2>Projektvorschläge vs. Notizen</h2>
    <canvas id="mapObjectChart"></canvas>
</div>
</div>

<div class="stat-box">
    <div class="chart-container">
        <h2>Länge der Beiträge</h2>
<span id="averageDescriptionLengthText" class="average-description-length">Durchschnittliche Länge: 999</span>

        <div>
            <button class="description-length-toggle active" data-filter="all">Alles</button>
            <button class="description-length-toggle" data-filter="true">Nur Notizen</button>
            <button class="description-length-toggle" data-filter="false">Nur Projektvorschläge</button>
        </div>
        <canvas id="descriptionLengthChart"></canvas>
    </div>
</div>


<div class="stat-box">
    <h2>Engagierte Projektvorschläge</h2>
   <select id="engagedProjectsThreshold">
    <option value="1">Über 1 Ansicht</option>
    <option value="2">Über 2 Ansichten</option>
    <option value="3">Über 3 Ansichten</option>
    <option value="4">Über 4 Ansichten</option>
    <option value="500">Über 500 Ansichten</option>
    <option value="1000">Über 1000 Ansichten</option>
</select>

    <button id="showEngagedProjectsList">Liste anzeigen</button>
    <canvas id="engagedProjectsChart"></canvas>
</div>

<div class="stat-box">
<h2>Neue Beiträge</h2>
<div>
    <label for="startDate">Startdatum:</label>
    <input type="date" id="startDate">
    <label for="endDate">Enddatum:</label>
    <input type="date" id="endDate">
	<div>
    <label for="excludeMapObjects">Nur Projektvorschläge</label>
    <input type="checkbox" id="excludeMapObjects">
    <label for="includeMapObjects">Nur Notizen</label>
    <input type="checkbox" id="includeMapObjects">
    <button id="updateChart">Update</button>
</div>
</div>

<canvas id="submissionChart"></canvas>
</div>



<div class="stat-box">
    <h2>Projektinteraktion</h2>
    <div>
        <label for="activityStartDate">Startdatum:</label>
        <input type="date" id="activityStartDate">
        <label for="activityEndDate">Enddatum:</label>
        <input type="date" id="activityEndDate">
        <button id="updateActivityChart">Update</button>
    </div>
    <canvas id="activityChart"></canvas>
</div>

<div class="stat-box">
    <h2>Projektansichten</h2>
    <div>
        <label for="viewsStartDate">Startdatum:</label>
        <input type="date" id="viewsStartDate">
        <label for="viewsEndDate">Enddatum:</label>
        <input type="date" id="viewsEndDate">
        <button id="updateViewsChart">Update</button>
    </div>
    <canvas id="viewsChart"></canvas>
</div>



</div>
</div>

<div id="projectsOverlay" class="overlay">
    <div class="overlay-content">
        <span class="closebtn" onclick="closeOverlay()">&times;</span>
        <h2>Engaged Projects List</h2>
        <ul id="projectsList"></ul>
    </div>
</div>

	
<div id="exportSection" style="display: none;">
<div class="stats-container">
<div class="stat-box">
    <h2>Projektdaten exportieren (.xlsx / .csv)</h2>
    <form id="exportForm" method="POST" action="{{ url_for('export_projects') }}">
        <div class="filter-options">
            <!-- Category Selection -->
            <div>
                <label for="category">Wählen Sie eine Kategorie:</label>
                <select id="category" name="category">
                    <option value="">Alle Kategorien</option>
                    <!-- Populate with actual categories -->
                </select>
				        <button type="submit" class="register-button" onclick="submitExportForm()">.xlsx exportieren</button>

            </div>
            </div>

            <!-- Date Filters -->
     

        <!-- Submit Button -->
    </form>
<form action="{{ url_for('export_csv') }}" method="get" style="margin-bottom:10px">
    <label for="category">Wählen Sie eine Kategorie:</label>
    <select id="category" name="category">
        <option value="">Alle Kategorien</option>
        {% for category in categories %}
        <option value="{{ category }}">{{ category }}</option>
        {% endfor %}
    </select>
    <button type="submit" class="register-button" >.csv exportieren</button>
</form>
	</div>


<div class="stat-box">

	<h2>Alle Daten herunterladen (.json/.geojson)</h2>
    <p>Die .json enthält alle Daten außer persönlichen Benutzerdaten.</p>

	            <a href="{{ url_for('download_data') }}" class="register-button" style="font-weight: bold;">.json exportieren</a>



<form action="{{ url_for('export_gis') }}" method="get" style="margin-bottom:10px">

    <label for="category">GIS Daten:</label>
    <select id="category" name="category">
        <option value="">Alle Kategorien</option>
        {% for category in categories %}
        <option value="{{ category }}">{{ category }}</option>
        {% endfor %}
    </select>
    <button type="submit" class="register-button">.geojson exportieren</button>
</form>
</div>






<div class="stat-box">
   <h2>Alle Beiträge löschen</h2>
    <p>Achtung: Dadurch werden alle Beiträge dauerhaft aus der Datenbank gelöscht.</p>
    <form method="POST" action="{{ url_for('delete_all_projects') }}">
        <button type="submit" class="register-button" onclick="return confirm('Are you sure you want to Alle Projektvorschläge löschen? This action cannot be undone.');">Alle Beiträge löschen</button>
    </form>
	</div>
</div>
</div>




    <div id="projectProposalsSection" style="display: none;">

 <div>
    <label for="search">Suchen nach Namen:</label>
    <input type="text" id="search" value="{{ search_query }}" onkeyup="submitForm()" style="margin-top:20px; margin-bottom:10px;">

    <label for="sort">Sortieren nach:</label>
    <select id="sort" onchange="submitForm()">
     <option value="score_desc" {% if sort == 'score_desc' %}selected{% endif %}>Höchste Bewertung zuerst</option>
                <option value="newest" {% if sort == 'newest' %}selected{% endif %}>Neuester Beitrtag</option>
                <option value="oldest" {% if sort == 'oldest' %}selected{% endif %}>Ältester Beitrag</option>
                <option value="category" {% if sort == 'category' %}selected{% endif %}>Kategorie</option>
                <option value="upvotes" {% if sort == 'upvotes' %}selected{% endif %}>Positive Bewertungen</option>
                <option value="downvotes" {% if sort == 'downvotes' %}selected{% endif %}>Negative Bewertungen</option>
                <option value="comments" {% if sort == 'comments' %}selected{% endif %}>Anzahl der Kommentare</option>
                <option value="alpha_asc" {% if sort == 'alpha_asc' %}selected{% endif %}>Titel (A-Z)</option>
                <option value="alpha_desc" {% if sort == 'alpha_desc' %}selected{% endif %}>Titel (Z-A)</option>
				</select>
</div>    

    {% with project_page=paginated_projects.page %}
        {% include 'partials/project_list_section.html' %}
    {% endwith %}
    </div>

    <div id="notesSection" style="display: none;">



<!-- Notizens Search Input -->
<div class="map-object-search-container" >
    <input type="text" id="searchMapObject" placeholder="Notizen suchen" onkeyup="searchMapObjects()"  style="margin-top:20px;">
</div>

    {% with paginated_map_objects=paginated_map_objects %}
        {% include 'partials/mapobject_list_section.html' %}
    {% endwith %}
    </div>




   <div id="commentsSection" style="display: none;">
<div class="comment-search-container">
    <input type="text" id="searchComment" placeholder="Kommentare suchen" onkeyup="searchComments()"  style="margin-top:20px;">
    <input type="text" id="searchCommentByUserId" placeholder="Nach Benutzer-ID suchen" onkeyup="searchCommentsByUserId()"  style="margin-top:20px;">
	
</div>
{% with paginated_comments=paginated_comments %}
    {% include 'partials/comments_section.html' %}
{% endwith %}
    </div>


  
    <div id="importantProjectsSection" style="display: none;">

<!-- Important Projects Section -->
<h2>Wichtige Projektvorschläge (Nur auf dieser Seite sichtbar)</h2>
<div class="project-list">
    {% for project in important_projects %}
        <div class="project-thumbnail">
            <h3>{{ project.name }}</h3>
            <p class="project-date">Kategorie: {{ project.category }}</p>
            <div class="project-details">
                Verfasser: ID {{ project.author }} <br>
                Kommentare: {{ project.comments_count }}, 👍 {{ project.upvotes }}, 👎 {{ project.downvotes }}
            </div>
            <a href="{{ url_for('project_details', project_id=project.id) }}" target="_blank">
                <img src="{{ url_for('static', filename='usersubmissions/' + project.image_file) }}" alt="{{ project.name }}" class="project-image">
            </a>
            <form method="POST" action="{{ url_for('admintools') }}">
                <input type="hidden" name="project_id" value="{{ project.id }}">
                <button type="submit" class="register-button" name="unmark_important">Von "Wichtig" entfernen</button>
				            <a href="{{ url_for('project_details', project_id=project.id) }}"  class="register-button" target="_blank">Anzeigen</a>

            </form>
        </div>
    {% else %}
        <p>Keine Projektvorschläge gefunden.</p>
    {% endfor %}
</div>




<!-- Featured Projects Section -->
<h2>Ausgewählte Projektvorschläge</h2>
<div class="project-list">
    {% for project in featured_projects %}
        <div class="project-thumbnail">
            <h3>{{ project.name }}</h3>
            <p class="project-date">Kategorie: {{ project.category }}</p>
            <div class="project-details">
                Verfasser: ID {{ project.author }}<br>
                Kommentare: {{ project.comments_count }}, 👍 {{ project.upvotes }}, 👎 {{ project.downvotes }}
            </div>
            <a href="{{ url_for('project_details', project_id=project.id) }}" target="_blank">
                <img src="{{ url_for('static', filename='usersubmissions/' + project.image_file) }}" alt="{{ project.name }}" class="project-image">
            </a>
            <form method="POST" action="{{ url_for('admintools') }}">
                <input type="hidden" name="project_id" value="{{ project.id }}">
                <button type="submit" name="unmark_featured"  class="register-button" >Von "Ausgewählt" entferen</button>
				            <a href="{{ url_for('project_details', project_id=project.id) }}"  class="register-button" target="_blank">Anzeigen</a>

            </form>
        </div>
    {% else %}
        <p>Keine Projekte gefunden.</p>
    {% endfor %}
</div>
</div>

   
    <div id="usersSection" style="display: none;">


<div class="project-list" >
    {% with paginated_users=paginated_users %}
        {% include 'partials/user_list_section.html' %}
    {% endwith %}
</div>
    </div>


<!-- Section for Deleting All Projects -->


	
	
</body>


   
<script>
     // Toggle the navigation overlay
    function toggleNavOverlay() {
        var navOverlay = document.getElementById('nav-overlay');
        if (navOverlay.style.display === 'block') {
            navOverlay.style.display = 'none';
        } else {
            navOverlay.style.display = 'block';
        }
    }

    // Close the navigation overlay when clicking on the overlay background or on a non-button element
    document.getElementById('nav-overlay').addEventListener('click', function(event) {
        // Close only if on mobile
        if (window.innerWidth <= 1080 && !event.target.closest('button, a')) {
            toggleNavOverlay();
        }
    });

    // Event listener for hamburger button
    document.getElementById('hamburger-button').addEventListener('click', toggleNavOverlay);

    // Resize event listener
    window.addEventListener('resize', function() {
        var navOverlay = document.getElementById('nav-overlay');
        // Show on desktop, hide on mobile
        if (window.innerWidth > 1080) {
            navOverlay.style.display = 'block';
        } else {
            navOverlay.style.display = 'none';
        }
    });
    
    // Set initial state of the nav-overlay based on device width
    window.onload = function() {
        var navOverlay = document.getElementById('nav-overlay');
        // Show on desktop, hide on mobile
        if (window.innerWidth > 1080) {
            navOverlay.style.display = 'block';
        } else {
            navOverlay.style.display = 'none';
        }
    };
</script>
<script>



document.addEventListener('DOMContentLoaded', function() {
    // Replace 'None' with '...' in all initial paginations
    const paginationContainers = document.querySelectorAll('.pagination-container');
    paginationContainers.forEach(container => {
        replaceNoneWithEllipsis(container);
    });

    attachPaginationEventListeners();
});


function attachPaginationEventListeners() {
    const paginationLinks = document.querySelectorAll('.ajax-pagination-link');
    console.log('Attaching event listeners to', paginationLinks.length, 'links');
    paginationLinks.forEach(link => {
        link.removeEventListener('click', handlePaginationClick);
        link.addEventListener('click', handlePaginationClick);
    });
}

function handlePaginationClick(event) {
    event.preventDefault();
    const url = this.getAttribute('href');
    console.log('Pagination link clicked:', url);

    // Find the closest parent with the class .pagination-container
    const paginationContainer = this.closest('.pagination-container');
    if (!paginationContainer) {
        console.error('Pagination container not found for link:', this);
        return; // Exit the function if no container is found
    }

    const sectionType = paginationContainer.getAttribute('data-pagination-type');
    console.log('Section type:', sectionType);

    // Prepare the updated URL based on the section type
    let updatedUrl = url;
    if (sectionType === 'map_object') {
        const searchQuery = document.getElementById('searchMapObject').value;
        updatedUrl = `${url}&searchMapObject=${searchQuery}`;
    } else if (sectionType === 'comment') {
        const searchQuery = document.getElementById('searchComment').value; // Assuming you have a search input for comments with this ID
        updatedUrl = `${url}&searchComment=${searchQuery}`;
    }

    updatePaginationContent(updatedUrl, sectionType);
}



function updateCommentList() {
    const userId = document.getElementById('searchCommentByUserId').value;
    const searchQuery = document.getElementById('searchComment').value;

    let queryParams = new URLSearchParams();
    if (userId) queryParams.set('searchCommentByUserId', userId);
    if (searchQuery) queryParams.set('searchComment', searchQuery);

    fetch(`/admintools?${queryParams.toString()}`, {
        headers: { 'X-Requested-With': 'XMLHttpRequest' }
    })
    .then(response => response.text())
    .then(html => {
        const newContent = document.createElement('div');
        newContent.innerHTML = html;

        const oldCommentContainer = document.getElementById('comment-list-container');
        const newCommentContainer = newContent.querySelector('#comment-list-container') || document.createElement('div');
        newCommentContainer.innerHTML = newCommentContainer.innerHTML || "<p>Keine Kommentare gefunden.</p>";

        oldCommentContainer.innerHTML = newCommentContainer.innerHTML;

        const oldPagination = document.querySelector('.pagination-container[data-pagination-type="comment"]');
        const newPagination = newContent.querySelector('.pagination-container[data-pagination-type="comment"]');

        if (oldPagination) {
            oldPagination.innerHTML = newPagination ? newPagination.innerHTML : '';
            oldPagination.style.display = newPagination && newPagination.innerHTML.trim() ? 'block' : 'none';
        }

        attachPaginationEventListeners();
    })
    .catch(error => console.error('Error:', error));
}


function searchComments() {
    updateCommentList();
}


function searchCommentsByUserId() {
    updateCommentList();
}


function updatePaginationContent(url, sectionType) {
    console.log('Fetching URL:', url, 'for section:', sectionType);
    fetch(url + '&request_type=' + sectionType, {
        headers: { 'X-Requested-With': 'XMLHttpRequest' },
        method: 'GET',
        credentials: 'same-origin'
    })
    .then(response => {
        console.log('Response received for', sectionType);
        return response.text();
    })
    .then(html => {
        console.log('HTML received for', sectionType, ':', html);
        const newContent = document.createElement('div');
        newContent.innerHTML = html;

        let oldContainer, newContainer;
        if (sectionType === 'project') {
            oldContainer = document.getElementById('project-list-container');
            newContainer = newContent.querySelector('#project-list-container');
        } else if (sectionType === 'map_object') {
            oldContainer = document.getElementById('map-object-list-container');
            newContainer = newContent.querySelector('#map-object-list-container');
        } else if (sectionType === 'comment') {
            oldContainer = document.getElementById('comment-list-container');
            newContainer = newContent.querySelector('#comment-list-container');
        } else if (sectionType === 'user') {
            oldContainer = document.getElementById('user-list-container');
            newContainer = newContent.querySelector('#user-list-container');
        }

        if (oldContainer && newContainer) {
            oldContainer.innerHTML = newContainer.innerHTML;
            console.log('Content updated for', sectionType);
        } else {
            console.error('Container elements not found for', sectionType);
        }

        reconstructPaginationButtons(newContent, sectionType);
        attachPaginationEventListeners();
    })
    .catch(error => {
        console.error('Error:', error);
    });
}



function handleResponse(response) {
    response.text()
    .then(html => {
        const newContent = document.createElement('div');
        newContent.innerHTML = html;

        const oldCommentContainer = document.getElementById('comment-list-container');
        let newCommentContainer = newContent.querySelector('#comment-list-container');

        oldCommentContainer.innerHTML = newCommentContainer ? newCommentContainer.innerHTML : "<p>Keine Kommentare gefunden.</p>";

        const oldPagination = document.querySelector('.pagination-container[data-pagination-type="comment"]');
        const newPagination = newContent.querySelector('.pagination-container[data-pagination-type="comment"]');

        if (newPagination) {
            oldPagination.innerHTML = newPagination.innerHTML;
        } else {
            oldPagination.innerHTML = '';
        }

        attachPaginationEventListeners();
    });
}

function handleError(error) {
    console.error('Error:', error);
}

function updateCommentSection(html) {
    const newContent = document.createElement('div');
    newContent.innerHTML = html;

    const oldCommentContainer = document.getElementById('comment-list-container');
    let newCommentContainer = newContent.querySelector('#comment-list-container');

    if (!newCommentContainer) {
        newCommentContainer = document.createElement('div');
        newCommentContainer.innerHTML = "<p>Keine Kommentare gefunden.</p>";
    }

    if (oldCommentContainer) {
        oldCommentContainer.innerHTML = newCommentContainer.innerHTML;
    } else {
        console.error('Comment list container not found');
    }

    const oldPagination = document.querySelector('.pagination-container[data-pagination-type="comment"]');
    const newPagination = newContent.querySelector('.pagination-container[data-pagination-type="comment"]');

    if (oldPagination) {
        if (newPagination && newPagination.innerHTML.trim()) {
            oldPagination.innerHTML = newPagination.innerHTML;
            replaceNoneWithEllipsis(oldPagination);
        } else {
            oldPagination.innerHTML = ''; // Clear the pagination if no results or single page
        }
    }

    attachPaginationEventListeners();
}


function searchMapObjects() {
    const searchQuery = document.getElementById('searchMapObject').value;

    fetch(`/admintools?map_object_page=1&searchMapObject=${searchQuery}`, {
        headers: { 'X-Requested-With': 'XMLHttpRequest' }
    })
    .then(response => response.text())
    .then(html => {
        const newContent = document.createElement('div');
        newContent.innerHTML = html;

        const oldMapObjectContainer = document.getElementById('map-object-list-container');
        let newMapObjectContainer = newContent.querySelector('#map-object-list-container');

        // Handle 'No results found' scenario
        if (!newMapObjectContainer) {
            newMapObjectContainer = document.createElement('div');
            newMapObjectContainer.innerHTML = "<p>Keine Ergebnisse gefunden.</p>";
        }

        if (oldMapObjectContainer) {
            oldMapObjectContainer.innerHTML = newMapObjectContainer.innerHTML;
        } else {
            console.error('Notizen list container not found');
        }

        // Update pagination
        const oldPagination = document.querySelector('.pagination-container[data-pagination-type="map_object"]');
const newPagination = newContent.querySelector('.pagination-container[data-pagination-type="map_object"]');

if (oldPagination) {
    if (newPagination && newPagination.innerHTML.trim()) {
        oldPagination.innerHTML = newPagination.innerHTML;
        replaceNoneWithEllipsis(oldPagination); // Call the function here
        oldPagination.style.display = 'block'; // Show pagination if there are links
    } else {
        oldPagination.style.display = 'none'; // Hide pagination if no links or no results
    }
}

        attachPaginationEventListeners(); // Reattach event listeners to new pagination links
    })
    .catch(error => {
        console.error('Error:', error);
    });
}



function searchAndSortProjects() {
    const searchQuery = document.getElementById('search').value;
    const sortOption = document.getElementById('sort').value;

    fetch(`/admintools?page=1&search=${searchQuery}&sort=${sortOption}`, {
        headers: { 'X-Requested-With': 'XMLHttpRequest' }
    })
    .then(response => response.text())
    .then(html => {
        const newContent = document.createElement('div');
        newContent.innerHTML = html;

        const oldProjectContainer = document.getElementById('project-list-container');
        let newProjectContainer = newContent.querySelector('#project-list-container');

        // Handle 'No results found' scenario
        if (!newProjectContainer) {
            newProjectContainer = document.createElement('div');
            newProjectContainer.innerHTML = "<p>Keine Ergebnisse gefunden.</p>";
        }

        if (oldProjectContainer) {
            oldProjectContainer.innerHTML = newProjectContainer.innerHTML;
        } else {
            console.error('Project list container not found');
        }

        // Update pagination
        const oldPagination = document.querySelector('.pagination-container[data-pagination-type="project"]');
        const newPagination = newContent.querySelector('.pagination-container[data-pagination-type="project"]');

        if (oldPagination) {
            if (newPagination && newPagination.innerHTML.trim()) {
                oldPagination.innerHTML = newPagination.innerHTML;
                replaceNoneWithEllipsis(oldPagination); // Update pagination content
                oldPagination.style.display = 'block'; // Show pagination if there are links
            } else {
                oldPagination.style.display = 'none'; // Hide pagination if no links or no results
            }
        }

        attachPaginationEventListeners(); // Reattach event listeners to new pagination links
    })
    .catch(error => {
        console.error('Error:', error);
    });
}

function extractTotalPagesFromPagination(paginationElement) {
    const pageLinks = paginationElement.querySelectorAll('.page-link');
    const pageNumbers = Array.from(pageLinks).map(link => parseInt(link.textContent.trim())).filter(num => !isNaN(num));
    return pageNumbers.length > 0 ? Math.max(...pageNumbers) : 1;
}


// Submit form when sorting options change or search input keyup event
function submitForm() {
    searchAndSortProjects();
}


function searchUsers() {
    const searchName = document.getElementById('searchUserByName').value;
    const searchId = document.getElementById('searchUserById').value;

    fetch(`/admintools?user_page=1&searchUserByName=${searchName}&searchUserById=${searchId}`, {
        headers: { 'X-Requested-With': 'XMLHttpRequest' }
    })
    .then(response => response.text())
    .then(html => {
        const newContent = document.createElement('div');
        newContent.innerHTML = html;
        const newContainer = newContent.querySelector('#user-list-container');
        const oldContainer = document.getElementById('user-list-container');
        if (oldContainer && newContainer) {
            oldContainer.innerHTML = newContainer.innerHTML;
        } else {
            console.error('User list container not found');
        }
        attachPaginationEventListeners(); // Reattach event listeners to new pagination links
    })
    .catch(error => {
        console.error('Error:', error);
    });
}


function updatePageParam(url, newPage) {
    const urlObj = new URL(url);
    urlObj.searchParams.set('page', newPage);
    return urlObj.toString();
}


function reconstructPaginationButtons(newContent, sectionType) {
    const oldPagination = document.querySelector(`.pagination-container[data-pagination-type="${sectionType}"] .pagination`);
    const newPagination = newContent.querySelector('.pagination');

    if (oldPagination && newPagination) {
        oldPagination.innerHTML = newPagination.innerHTML;
        replaceNoneWithEllipsis(oldPagination);
        console.log('Pagination reconstructed for', sectionType);
    } else {
        console.error('Pagination elements not found in new content for', sectionType);
    }
}

function replaceNoneWithEllipsis(paginationElement) {
    const pageLinks = paginationElement.querySelectorAll('.page-link');
    pageLinks.forEach(link => {
        if (link.textContent.trim() === 'None') {
            link.textContent = '...'; // Replace 'None' with '...'
            link.href = '#'; // Set href to '#' to prevent any action
            link.addEventListener('click', (e) => e.preventDefault()); // Prevent default action
        }
    });
}



function extractTotalPages() {
    const pageItems = Array.from(document.querySelectorAll('.pagination .page-link'));
    const pageNumbers = pageItems.map(item => parseInt(item.textContent.trim())).filter(num => !isNaN(num));
    return pageNumbers.length > 0 ? Math.max(...pageNumbers) : 1;
}

</script>






<script>
function deleteComment(commentId) {
    if (!confirm("Are you sure you want to delete this comment?")) {
        return; // Do nothing if user cancels the confirmation
    }

    // Send the AJAX request
    fetch('/delete_comment/' + commentId, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        }
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            // Remove the comment from the DOM
            const commentElement = document.getElementById('comment-' + commentId);
            commentElement.remove();
        } else {
            alert(data.message); // Show error message
        }
    })
    .catch(error => console.error('Error:', error));
}
</script>

<script>
document.addEventListener("DOMContentLoaded", function() {
    // Function to fetch unique categories and populate the select dropdown
    function fetchUniqueCategories() {
        console.debug("Fetching unique categories for dropdown");
        fetch('/get_unique_categories')
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    const categorySelect = document.getElementById('category');
                    categorySelect.innerHTML = ''; // Clear existing options
                    const allCategoriesOption = document.createElement('option');
                    allCategoriesOption.value = '';
                    allCategoriesOption.textContent = 'Alle Kategorien';
                    categorySelect.appendChild(allCategoriesOption);
                    data.categories.forEach(category => {
                        const option = document.createElement('option');
                        option.value = category;
                        option.textContent = category;
                        categorySelect.appendChild(option);
                    });
                    console.debug("Unique categories populated in dropdown");
                } else {
                    console.error("Failed to fetch unique categories");
                }
            })
            .catch(error => console.error('Error fetching unique categories:', error));
    }

    fetchUniqueCategories(); // Call the function to populate unique categories on page load
});
</script>
<script>

function toggleExportSection() {
            var exportSection = document.querySelector('.export-section');
            if (exportSection.style.display === 'none') {
                exportSection.style.display = 'block';
                console.debug('Export section opened');
            } else {
                exportSection.style.display = 'none';
                console.debug('Export section closed');
            }
        }

        // Add click event listener to the toggle button

function toggleProjectProposals() {
            var projectProposalsSection = document.getElementById('projectProposalsSection');
            if (projectProposalsSection.style.display === 'none') {
                projectProposalsSection.style.display = 'block';
                console.debug('Projektvorschläge section opened');
			} else {
            projectProposalsSection.style.display = 'none';
            console.debug('Projektvorschläge section closed');
        }
    }


function toggleNotes() {
            var notesSection = document.getElementById('notesSection');
            if (notesSection.style.display === 'none') {
                notesSection.style.display = 'block';
                console.debug('Notizen section opened');
            } else {
                notesSection.style.display = 'none';
                console.debug('Notizen section closed');
            }
        }



document.addEventListener('DOMContentLoaded', function() {
    toggleSection('deleteAllProjectsSection'); // Open the 'Statistik' section by default

    document.querySelectorAll('.control-bar .c-button').forEach(button => {
        button.addEventListener('click', function() {
            const sectionId = this.getAttribute('data-section-id');
            toggleSection(sectionId);
        });
    });
});

let currentOpenSection = 'deleteAllProjectsSection'; // Set 'Statistik' as the default section

function toggleSection(sectionId) {
    const section = document.getElementById(sectionId);
    const defaultSection = document.getElementById('deleteAllProjectsSection');
    const defaultButton = document.getElementById('toggleDeleteAllProjects');

    if (currentOpenSection !== sectionId) {
        const currentSection = document.getElementById(currentOpenSection);
        if (currentSection) {
            currentSection.style.display = 'none';
            document.querySelector(`[data-section-id="${currentOpenSection}"]`).classList.remove('active');
            console.debug(currentOpenSection + ' section closed');
        }
    }

    if (section.style.display === 'none') {
        section.style.display = 'block';
        document.querySelector(`[data-section-id="${sectionId}"]`).classList.add('active');
        console.debug(sectionId + ' section opened');
        currentOpenSection = sectionId;

        if (defaultSection && defaultSection !== section && defaultSection.style.display === 'block') {
            defaultSection.style.display = 'none';
            defaultButton.classList.remove('active');
            console.debug('Default section closed');
        }
    } else {
        section.style.display = 'none';
        document.querySelector(`[data-section-id="${sectionId}"]`).classList.remove('active');
        console.debug(sectionId + ' section closed');

        if (defaultSection.style.display === 'none') {
            defaultSection.style.display = 'block';
            defaultButton.classList.add('active');
            console.debug('Default section opened');
            currentOpenSection = 'deleteAllProjectsSection';
        } else {
            currentOpenSection = null;
        }
    }
}


// Attach the toggleSection function to the new button
document.getElementById('toggleDeleteAllProjects').addEventListener('click', function() {
toggleSection('deleteAllProjectsSection');
});

// Attach the toggleSection function to each button
document.querySelectorAll('.control-bar .c-button').forEach(button => {
    button.addEventListener('click', function() {
        const sectionId = this.getAttribute('data-section-id');
        toggleSection(sectionId);
    });
});

function capitalizeFirstLetter(string) {
    return string.charAt(0).toUpperCase() + string.slice(1);
}

// Update event listeners
document.getElementById('toggleExportSection').addEventListener('click', function() { toggleSection('exportSection'); });
document.getElementById('toggleProjectProposals').addEventListener('click', function() { toggleSection('projectProposalsSection'); });
document.getElementById('toggleNotes').addEventListener('click', function() { toggleSection('notesSection'); });
document.getElementById('toggleComments').addEventListener('click', function() { toggleSection('commentsSection'); });
document.getElementById('toggleImportantProjects').addEventListener('click', function() { toggleSection('importantProjectsSection'); });
document.getElementById('toggleFeaturedProjects').addEventListener('click', function() { toggleSection('featuredProjectsSection'); });
document.getElementById('toggleUsers').addEventListener('click', function() { toggleSection('usersSection'); });


function submitExportForm() {
    console.debug("Export form submitted.");

    var formData = new FormData(document.getElementById("exportForm"));
    formData.forEach(function(value, key){
        console.debug("Form Data - Key:", key, "Value:", value);
    });

    console.debug("Sending POST request to /export_projects");

    fetch('{{ url_for("export_projects") }}', {
        method: 'POST',
        body: formData
    })
    .then(response => {
        console.debug("Server Response:", response);
        if (!response.ok) {
            console.error('Server responded with status:', response.status);
            throw new Error('Server responded with status ' + response.status);
        }
        return response.json(); // Expecting a JSON response now
    })
    .then(data => {
        if (data.filepath) {
            // Trigger download using the filepath received
            window.location.href = data.filepath; // This will start the download
        } else {
            console.error('File path not received from server');
        }
    })
    .catch(error => {
        console.error('Export error:', error);
    });

    return false; // Prevent traditional form submission
}


</script>

<script>
function logLayoutChange() {
    const width = window.innerWidth;
    if (width > 1445) {
        console.debug("admintools.html: screen is wider than 1445px - displaying 3 boxes next to each other.");
    } else if (width >= 1080 && width <= 1445) {
        console.debug("admintools.html: screen is wide between 1080 and 1445px -- displaying 2 boxes next to each other.");
    } else {
        console.debug("admintools.html: screen is less than 1080px wide -- displaying 1 box per row.");
    }
}

// Log layout change on page load and resize
window.addEventListener('load', logLayoutChange);
window.addEventListener('resize', logLayoutChange);
</script>

<script>
let currentMapObjectFilter = 'all'; // Initial filter state
let chartInstances = {}; // Object to hold chart instances
let currentDescriptionLengthFilter = 'all'; // Filter state for description length chart
let showPercentage = false; // Global variable to keep track of the toggle state
let engagedProjectsChart = null;

    document.getElementById('engagedProjectsThreshold').addEventListener('change', function() {
        const threshold = this.value;
        fetchAndRenderEngagedProjectsChart(threshold);
    });

document.getElementById('showEngagedProjectsList').addEventListener('click', function() {
    document.getElementById('projectsOverlay').style.display = 'block';
    loadEngagedProjects();
});

function closeOverlay() {
    document.getElementById('projectsOverlay').style.display = 'none';
}

function loadEngagedProjects() {
    const threshold = document.getElementById('engagedProjectsThreshold').value || 1;
    fetch(`/get_engaged_projects?threshold=${threshold}`)
        .then(response => response.json())
        .then(projects => {
            const listElement = document.getElementById('projectsList');
            listElement.innerHTML = '';

            if (projects.length === 0) {
                listElement.innerHTML = '<li>No projects found</li>';
                return;
            }

            projects.forEach(project => {
                const listItem = document.createElement('li');
                listItem.innerHTML = `<strong>${project.name}</strong> with ${project.views} views, ${project.upvotes} upvotes, ${project.downvotes} downvotes, ${project.comments} comments, ${project.bookmarks} bookmarks, and ${project.reports} reports.`;
                listElement.appendChild(listItem);
            });

            console.log(`Loaded projects for threshold ${threshold}:`, projects);
        })
        .catch(error => {
            console.error('Error loading projects:', error);
            listElement.innerHTML = '<li>Error loading projects</li>';
        });
}



// Updated function for fetching engaged projects
function getEngagedProjects() {
    const threshold = document.getElementById('engagedProjectsThreshold').value;
    return fetch(`/get_engaged_projects_data?threshold=${threshold}`)
        .then(response => {
            if (!response.ok) {
                throw new Error('Network response was not ok');
            }
            return response.json();
        })
        .then(data => {
            console.log('Engaged projects fetched:', data);
            return Object.entries(data).map(([category, count]) => {
                return { name: category, count: count };
            });
        });
}



document.addEventListener("DOMContentLoaded", function() {
    fetchChartData(); // Load all charts initially
    setupToggleButtons();
    setupDescriptionLengthToggleButtons();
    setupPercentageToggle();
});




    function setupToggleButtons() {
        const toggleButtons = document.querySelectorAll('.mapobject-toggle');
        toggleButtons.forEach(button => {
            button.addEventListener('click', () => {
                currentMapObjectFilter = button.getAttribute('data-filter');
                console.log(`Toggled to: ${currentMapObjectFilter}`);
                fetchChartData(true);
                updateButtonStates(toggleButtons, currentMapObjectFilter);
            });
        });
    }

    function updateButtonStates(buttons, currentFilter) {
        buttons.forEach(button => {
            if (button.getAttribute('data-filter') === currentFilter) {
                button.classList.add('active');
            } else {
                button.classList.remove('active');
            }
        });
    }

    function setupDescriptionLengthToggleButtons() {
        const descriptionLengthToggleButtons = document.querySelectorAll('.description-length-toggle');
        descriptionLengthToggleButtons.forEach(button => {
            button.addEventListener('click', () => {
                currentDescriptionLengthFilter = button.getAttribute('data-filter');
                console.log(`Description Length Chart: Toggled to: ${currentDescriptionLengthFilter}`);
                fetchChartData(false, true);
                updateButtonStates(descriptionLengthToggleButtons, currentDescriptionLengthFilter);
            });
        });
    }

    function setupPercentageToggle() {
        const togglePercentageBtn = document.getElementById('togglePercentage');
        togglePercentageBtn.addEventListener('click', () => {
            showPercentage = !showPercentage;
            console.log(`Toggle Percentage: Now showing ${showPercentage ? 'percentages' : 'numbers'}`);
            togglePercentageBtn.textContent = showPercentage ? 'Show Numbers' : 'Show Percentages';
            fetchChartData(true); // Update only project category chart
        });
    }

function fetchChartData(updateOnlyCategoryChart = false, updateOnlyDescriptionLengthChart = false) {
    console.log("Fetching chart data...");
    const url = `/get_chart_data?filter=${currentMapObjectFilter}&description_length_filter=${currentDescriptionLengthFilter}`;
    fetch(url)
    .then(response => response.json())
    .then(data => {
        console.log('Chart data received:', data);

        if (document.getElementById('averageDescriptionLengthText')) {
            const averageLength = data.averageDescriptionLength ? data.averageDescriptionLength.toFixed(2) : 0;
            document.getElementById('averageDescriptionLengthText').textContent = `Durchschnittliche Länge: ${averageLength}`;
            console.log(`Updated average description length to: ${averageLength}`);
        }

        if (!updateOnlyCategoryChart && !updateOnlyDescriptionLengthChart) {
                if (document.getElementById('mapObjectChart')) {
                    renderPieChart('mapObjectChart', '', data.mapobjectCounts, true);
                }
                if (document.getElementById('descriptionLengthChart')) {
                    renderPieChart('descriptionLengthChart', '', data.descriptionLengthCounts, false, true);
                }
                if (document.getElementById('projectCategoryChart')) {
                    renderPieChart('projectCategoryChart', '', data.categoryCounts);
                    updateMostUsedCategoryText(data.categoryCounts);
                }
            } else if (updateOnlyCategoryChart) {
                if (document.getElementById('projectCategoryChart')) {
                    renderPieChart('projectCategoryChart', '', data.categoryCounts);
                    updateMostUsedCategoryText(data.categoryCounts);
                }
            } else if (updateOnlyDescriptionLengthChart) {
                if (document.getElementById('descriptionLengthChart')) {
                    renderPieChart('descriptionLengthChart', '', data.descriptionLengthCounts, false, true);
                }
            }
        })
        .catch(error => console.error('Error fetching chart data:', error));
    }

    function updateMostUsedCategoryText(categoryCounts) {
        const mostUsedCategory = Object.keys(categoryCounts).reduce((a, b) => categoryCounts[a] > categoryCounts[b] ? a : b);
        const totalProjects = Object.values(categoryCounts).reduce((a, b) => a + b, 0);
        const mostUsedPercentage = ((categoryCounts[mostUsedCategory] / totalProjects) * 100).toFixed(2);

        const mostUsedCategoryText = `Häufigste Kategorie: <strong>${mostUsedCategory}</strong> - <strong>${categoryCounts[mostUsedCategory]}</strong> Beiträge (<strong>${mostUsedPercentage}%</strong> aller Beiträge)`;
        document.getElementById('mostUsedCategoryText').innerHTML = mostUsedCategoryText;
        console.log('Updated most used category text:', mostUsedCategoryText);
    }

    function renderPieChart(canvasId, title, data, isMapObjectChart = false, isDescriptionLengthChart = false) {
        const canvas = document.getElementById(canvasId);
        if (!canvas) {
            console.error(`Canvas element not found: ${canvasId}`);
            return;
        }

        const ctx = canvas.getContext('2d');

        if (chartInstances[canvasId]) {
            chartInstances[canvasId].destroy();
        }

        let backgroundColors = defineBackgroundColors(data, isMapObjectChart, isDescriptionLengthChart);

        chartInstances[canvasId] = new Chart(ctx, {
            type: 'pie',
            data: {
                labels: Object.keys(data),
                datasets: [{
                    data: Object.values(data),
                    backgroundColor: backgroundColors,
                    datalabels: {
                        formatter: (value, ctx) => {
                            if (showPercentage) {
                                const total = Object.values(data).reduce((a, b) => a + b, 0);
                                const percentage = (value / total * 100).toFixed(2);
                                return percentage + '%';
                            } else {
                                return value;
                            }
                        },
                        color: '#FFFFFF',
                        font: {
                            weight: 'bold',
                            size: 16
                        },
                        textStrokeColor: '#000000',
                        textStrokeWidth: 4
                    }
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    datalabels: {
                        color: '#FFFFFF',
                        font: {
                            weight: 'bold',
                            size: 14
                        },
                        textStrokeColor: '#000000',
                        textStrokeWidth: 4
                    },
                    legend: {
                        labels: {
                            font: {
                                weight: 'bold',
                                size: 14,
                                color: 'black'
                            }
                        }
                    }
                },
                title: createChartOptions(title).title
            }
        });

        console.log(`Rendered ${canvasId} chart with data:`, data);
    }

    function defineBackgroundColors(data, isMapObjectChart, isDescriptionLengthChart) {
        if (isMapObjectChart) {
            return ['#021c4c', '#e82b10'];
        } else if (isDescriptionLengthChart) {
            return ['#021c4c', '#028d9e', '#f6e0bf', '#f57736', '#e82b10'];
        } else {
            const categoryColors = {
                'Öffentliche Plätze': '#ff5c00',
                'Transport': '#133873',
                'Gesundheit': '#9a031e',
                'Umwelt': '#4caf50',
                'Bildung': '#eab003',
                'Andere': '#212121',
                'Sport': '#3d4f53',
                'Kultur': '#431307',
                'Verwaltung': '#653993'
            };
            return Object.keys(data).map(category => categoryColors[category] || '#999999');
        }
    }

    function createChartOptions(title) {
        return {
            responsive: true,
            title: {
                display: title !== '',
                text: title,
                font: {
                    weight: 'bold',
                    size: 20,
                    color: 'black'
                }
            },
            plugins: {
                legend: {
                    labels: {
                        font: {
                            weight: 'bold',
                            size: 14,
                            color: 'black'
                        }
                    }
                }
            }
        };
    }



let submissionChart = null; // Reference to the 'Submissions over time' chart
let activityChart = null; // Reference to the 'Activity over time' chart
let viewsChart = null;


function generateDateLabels(startDate, endDate) {
    const start = new Date(startDate);
    const end = new Date(endDate);
    const labels = [];
    for (let date = new Date(start); date <= end; date.setDate(date.getDate() + 1)) {
        labels.push(`${('0' + date.getDate()).slice(-2)}.${('0' + (date.getMonth() + 1)).slice(-2)}.${date.getFullYear()}`);
    }
    return labels;
}

    function updateChart(startDate, endDate, includeMapObjects, excludeMapObjects) {
        let urlParams = `start=${startDate}&end=${endDate}`;
        if (includeMapObjects) {
            urlParams += '&includeMapObjects=true';
        } else if (excludeMapObjects) {
            urlParams += '&excludeMapObjects=true';
        }
        const url = `/project_submission_stats?${urlParams}`;
        console.log(`Fetching data with URL: ${url}`);
    
    fetch(url)
        .then(response => response.json())
        .then(data => {
            console.log("Received data:", data);

            const ctx = document.getElementById('submissionChart').getContext('2d');
            const categories = Object.keys(data);

            if (categories.length === 0) {
                console.log("No data available for the selected date range");
                return;
            }

            categories.forEach(category => console.log(category, data[category]));

            const labels = generateDateLabels(startDate, endDate);
            console.log("Labels for chart:", labels);

            const categoryColors = {
                'Öffentliche Plätze': '#ff5c00',
                'Transport': '#133873',
                'Gesundheit': '#9a031e',
                'Umwelt': '#4caf50',
                'Bildung': '#eab003',
                'Andere': '#212121',
                'Sport': '#3d4f53',
                'Kultur': '#431307',
                'Verwaltung': '#653993'
            };

            const datasets = categories.map(category => {
                const categoryData = labels.map(label => {
                    const [day, month, year] = label.split('.');
                    const formattedDate = `${year}-${month}-${day}`;
                    return data[category][formattedDate] || 0;
                });
                console.log(`Data for category ${category}:`, categoryData);
                return {
                    label: category,
                    data: categoryData,
                    backgroundColor: categoryColors[category] + '66',
                    borderColor: categoryColors[category],
                    borderWidth: 3
                };
            });

            if (submissionChart) {
				submissionChart.destroy();
			}

    submissionChart = new Chart(ctx, {
         type: 'line',
    data: { labels: labels, datasets: datasets.map(dataset => ({ ...dataset, fill: false })) },
        options: {
            scales: { y: { beginAtZero: true } },
            plugins: {
                legend: {
                    labels: {
                        font: {
                            weight: 'bold',
                            size: 14,
                            color: 'black'
                        }
                    }
                }
            },
            title: {
                display: false,
                text: 'Your Chart Title Here', // Change as per requirement
                font: {
                    weight: 'bold',
                    size: 16,
                    color: 'black'
                }
            }
        }
    });

    console.log("Submission Chart configuration:", submissionChart.config); // Updated from myChart to submissionChart
        })
        .catch(error => {
            console.error('Error fetching data:', error);
            console.log("Failed to Update due to error in data fetching.");
        });
}

   document.getElementById('updateChart').addEventListener('click', () => {
        const startDate = document.getElementById('startDate').value;
        const endDate = document.getElementById('endDate').value;
        const includeMapObjects = document.getElementById('includeMapObjects').checked;
        const excludeMapObjects = document.getElementById('excludeMapObjects').checked;
        console.log(`Updating chart with Startdatum: ${startDate}, Enddatum: ${endDate}, includeMapObjects: ${includeMapObjects}, excludeMapObjects: ${excludeMapObjects}`);
        updateChart(startDate, endDate, includeMapObjects, excludeMapObjects);
    });


document.getElementById('updateActivityChart').addEventListener('click', () => {
    const startDate = document.getElementById('activityStartDate').value;
    const endDate = document.getElementById('activityEndDate').value;
    updateActivityChart(startDate, endDate);
});

function updateActivityChart(startDate, endDate) {
    const url = `/get_activity_data?start=${startDate}&end=${endDate}`;
    console.log(`Fetching activity data with URL: ${url}`);

    fetch(url)
        .then(response => response.json())
        .then(data => {
            console.log("Received activity data:", data);
            const ctx = document.getElementById('activityChart').getContext('2d');
            const labels = generateDateLabels(startDate, endDate);

            const datasets = [
                {
                    label: 'Upvotes 👍',
                    data: labels.map(label => convertDateAndGetData(label, data.upvotes)),
                    borderColor: '#4caf50',
                    fill: false,
                },
                {
                    label: 'Downvotes 👎',
                    data: labels.map(label => convertDateAndGetData(label, data.downvotes)),
                    borderColor: '#9a031e',
                    fill: false,
                },
                {
                    label: 'Kommentare',
                    data: labels.map(label => convertDateAndGetData(label, data.comments)),
                    borderColor: '#133873',
                    fill: false,
                },
                {
                    label: 'Meldungen',
                    data: labels.map(label => convertDateAndGetData(label, data.reports)),
                    borderColor: '#eab003',
                    fill: false,
                },
                {
                    label: 'Lesezeichen',
                    data: labels.map(label => convertDateAndGetData(label, data.bookmarks)),
                    borderColor: '#653993',
                    fill: false,
                }
            ];

            if (activityChart) {
                activityChart.destroy();
            }

            activityChart = new Chart(ctx, {
                type: 'line',
                data: { labels: labels, datasets: datasets },
                options: {
                    scales: { y: { beginAtZero: true } },
                    plugins: {
                        legend: {
                            labels: {
                                font: { weight: 'bold', color: 'black' }
                            }
                        }
                    }
                }
            });
    console.log("Activity Chart configuration:", activityChart.config); // Updated from myChart to activityChart
        })
        .catch(error => {
            console.error('Error fetching activity data:', error);
        });
}

function convertDateAndGetData(label, dataDict) {
    let formattedDate = label.split('.').reverse().join('-'); // Convert to YYYY-MM-DD
    return dataDict[formattedDate] || 0;
}



function generateDateLabels(startDate, endDate) {
    const start = new Date(startDate);
    const end = new Date(endDate);
    const labels = [];
    for (let date = new Date(start); date <= end; date.setDate(date.getDate() + 1)) {
        labels.push(`${('0' + date.getDate()).slice(-2)}.${('0' + (date.getMonth() + 1)).slice(-2)}.${date.getFullYear()}`);
    }
    return labels;
}

document.getElementById('updateViewsChart').addEventListener('click', () => {
    const startDate = document.getElementById('viewsStartDate').value;
    const endDate = document.getElementById('viewsEndDate').value;
    updateViewsChart(startDate, endDate);
});

function fetchAndRenderEngagedProjectsChart(threshold) {
    fetch(`/get_engaged_projects?threshold=${threshold}`)
        .then(response => response.json())
        .then(data => {
            if (!data || data.length === 0) {
                console.log("No data available for the threshold:", threshold);
                return;
            }

            // Process the data to create category counts
            let categoryCounts = data.reduce((counts, project) => {
                counts[project.category] = (counts[project.category] || 0) + 1;
                return counts;
            }, {});

            const ctx = document.getElementById('engagedProjectsChart').getContext('2d');
            if (engagedProjectsChart) engagedProjectsChart.destroy();

            const backgroundColors = ['#003056', '#36A2EB', '#e82b10', '#f57736', '#f6e0bf', '#028d9e', '#036a90'];

            engagedProjectsChart = new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: Object.keys(categoryCounts),
                    datasets: [{
                        data: Object.values(categoryCounts),
                        backgroundColor: backgroundColors,
                    }]
                },
                options: {
                    title: {
                        display: false,
                        text: 'Engagierte Projektvorschläge'
                    }
                }
            });

            console.log("Engaged Projects Chart loaded with data:", categoryCounts);
        })
        .catch(error => {
            console.error('Error:', error);
            if (engagedProjectsChart) engagedProjectsChart.destroy();
        });
}


document.addEventListener("DOMContentLoaded", function() {
    fetchAndRenderEngagedProjectsChart(1); // default threshold
});




function updateViewsChart(startDate, endDate) {
    const url = `/get_view_data?start=${startDate}&end=${endDate}`;
    console.log(`Fetching views data with URL: ${url}`);

    fetch(url)
        .then(response => response.json())
        .then(data => {
            console.log("Received views data:", data);
            const ctx = document.getElementById('viewsChart').getContext('2d');
            const labels = generateDateLabels(startDate, endDate);

            const dailyViewsData = labels.map(label => {
                let formattedDate = label.split('.').reverse().join('-'); // Convert to YYYY-MM-DD
                return data.daily_views[formattedDate] || 0;
            });

            // Calculate cumulative total views
            const cumulativeTotalViewsData = dailyViewsData.reduce((acc, current, index) => {
                if (index === 0) {
                    acc.push(current);
                } else {
                    acc.push(acc[index - 1] + current);
                }
                return acc;
            }, []);

            const datasets = [
                {
                    label: 'Tägliche Ansichten',
                    data: dailyViewsData,
                    borderColor: '#e82b10',
                    fill: false,
                },
                {
                    label: 'Gesamtansichten',
                    data: cumulativeTotalViewsData,
                    borderColor: '#021c4c',
                    fill: false,
                }
            ];

            if (viewsChart) {
                viewsChart.destroy();
            }

            viewsChart = new Chart(ctx, {
                type: 'line',
                data: { labels: labels, datasets: datasets },
                options: {
                    scales: { y: { beginAtZero: true } },
                    plugins: {
                        legend: {
                            labels: {
                                font: { weight: 'bold', color: 'black' }
                            }
                        }
                    }
                }
            });
    console.log("Views Chart configuration:", viewsChart.config); // Updated from myChart to viewsChart
        })
        .catch(error => {
            console.error('Error fetching views data:', error);
        });
}


window.onload = function() {
    // Initialize 'Submissions over time' chart
    const initialEndDateSubmission = new Date();
    const initialStartDateSubmission = new Date(initialEndDateSubmission);
    initialStartDateSubmission.setDate(initialEndDateSubmission.getDate() - 7);
    document.getElementById('startDate').value = initialStartDateSubmission.toISOString().split('T')[0];
    document.getElementById('endDate').value = initialEndDateSubmission.toISOString().split('T')[0];
    updateChart(initialStartDateSubmission.toISOString().split('T')[0], initialEndDateSubmission.toISOString().split('T')[0], false, false);

    // Initialize 'Activity over time' chart
    const initialEndDateActivity = new Date();
    const initialStartDateActivity = new Date(initialEndDateActivity);
    initialStartDateActivity.setDate(initialEndDateActivity.getDate() - 7);
    document.getElementById('activityStartDate').value = initialStartDateActivity.toISOString().split('T')[0];
    document.getElementById('activityEndDate').value = initialEndDateActivity.toISOString().split('T')[0];
    updateActivityChart(initialStartDateActivity.toISOString().split('T')[0], initialEndDateActivity.toISOString().split('T')[0]);

	const initialEndDateViews = new Date();
    const initialStartDateViews = new Date(initialEndDateViews);
    initialStartDateViews.setDate(initialEndDateViews.getDate() - 7);
    document.getElementById('viewsStartDate').value = initialStartDateViews.toISOString().split('T')[0];
    document.getElementById('viewsEndDate').value = initialEndDateViews.toISOString().split('T')[0];
    updateViewsChart(initialStartDateViews.toISOString().split('T')[0], initialEndDateViews.toISOString().split('T')[0]);
};

</script>

</html>
